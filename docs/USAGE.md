# btc-signal-bot 利用ガイド

## 対応プラットフォーム

| プラットフォーム | 対応状況 |
|------------------|----------|
| Discord | 対応 (コマンド + 自動検出 + シグナル配信) |
| Telegram | 対応 (コマンド + シグナル配信) |

どちらか一方のみ、または両方同時に利用可能。

## Discord での使い方

### Bot をサーバーに追加

1. Discord Developer Portal で Bot を作成
2. OAuth2 URL で bot scope + Send/Read 権限を設定
3. URL にアクセスしてサーバーに招待
4. Bot tab で Message Content Intent を ON にする

### コマンド

| コマンド | 説明 |
|----------|------|
| `!ping` | 疎通確認 |
| `!price` | BTC 現在価格を表示 (通貨ペアは TRADE_SYMBOL で設定) |
| `!status` | Bot ステータス (uptime, シグナル数, サブスクライバー数) |
| `!history` | 直近シグナル一覧 (最大5件) |
| `!subscribe` | サブスク登録 ($5/月、Stripe 決済リンク発行) |
| `!trade buy` | BTC 買い注文 (管理者のみ) |
| `!trade sell` | BTC 売り注文 (管理者のみ) |

### 自動検出キーワード

メッセージに以下が含まれると自動でトレードを実行 (**管理者のみ**):

| キーワード | 方向 |
|------------|------|
| 🚀 / buy / long / 入 / 買い | BUY |
| sell / short / 出 / 売り | SELL |

### シグナル配信

`DISCORD_SIGNAL_CHANNEL_ID` を設定すると、シグナルと日次サマリーが自動でそのチャンネルに投稿される。

## Telegram での使い方

### Bot を追加

1. Telegram で Bot を検索して開く
2. `/start` を送信して登録

### コマンド

| コマンド | 説明 |
|----------|------|
| `/start` | ウェルカムメッセージ |
| `/price` | BTC 現在価格 (通貨ペアは TRADE_SYMBOL で設定) |
| `/status` | Bot ステータス (uptime, シグナル数, サブスクライバー数) |
| `/history` | 直近シグナル一覧 (最大5件) |
| `/subscribe` | サブスク登録 ($5/月、Stripe 決済リンク発行) |
| `/help` | ヘルプ |

### テキストでのトレード

Discord と同様、メッセージ内の BUY/SELL キーワードを自動検出してトレードを実行 (**管理者のみ**)。

### シグナル配信

`TELEGRAM_CHANNEL_ID` を設定すると、シグナルと日次サマリーが自動でそのチャンネルに投稿される。

## トレード権限

トレード実行は管理者のみに制限可能。

| 環境変数 | 説明 |
|----------|------|
| `ADMIN_DISCORD_IDS` | トレード許可する Discord ユーザー ID (カンマ区切り) |
| `ADMIN_TELEGRAM_IDS` | トレード許可する Telegram ユーザー ID (カンマ区切り) |

- ID を設定 → そのユーザーのみトレード可能
- 未設定 (空) → 全ユーザーがトレード可能
- シグナル閲覧 (`!price`, `/price` 等) は全ユーザーに開放

## レート制限

コマンドの連打を防止するレート制限機能あり。

| 環境変数 | デフォルト | 説明 |
|----------|-----------|------|
| `RATE_LIMIT_WINDOW` | 60000 (1分) | 制限ウィンドウ (ms) |
| `RATE_LIMIT_MAX` | 10 | ウィンドウ内の最大リクエスト数 |

制限に達すると「⏳ レート制限中です。しばらくお待ちください。」と返される。

## シグナルの読み方

シグナルは以下のフォーマットで配信される:

```
#BTCto70k シグナル

方向: BUY
通貨: BTC/JPY
価格: ¥10,200,000
ターゲット: $70,351
ストップロス: $66,936
リスク: 1%
強度: 4/6

根拠:
  - RSI 28.5 (売られすぎ)
  - SMA ゴールデンクロス
  - 1h足でも同方向

2026-02-16T12:00:00.000Z
```

| 項目 | 説明 |
|------|------|
| 方向 | BUY (買い) / SELL (売り) |
| 価格 | シグナル発生時の BTC 価格 |
| ターゲット | 利確目標価格 (BUY: +3%, SELL: -3%) |
| ストップロス | 損切り価格 (BUY: -2%, SELL: +2%) |
| リスク | 推奨リスク割合 |
| 強度 | シグナルの確信度 (最大6) |
| 根拠 | シグナル判定に使われたテクニカル指標の根拠 |

### 判定に使われる指標

| 指標 | BUY 条件 | SELL 条件 |
|------|----------|-----------|
| RSI (14) | < 30 (売られすぎ) / < 40 (低め) | > 70 (買われすぎ) / > 60 (高め) |
| SMA クロス | ゴールデンクロス (SMA5 > SMA20) | デスクロス (SMA5 < SMA20) |
| トレンド位置 | 価格 > SMA5 > SMA20 | 価格 < SMA5 < SMA20 |
| 1h 足確認 | 1h 足でも同方向 | 1h 足でも同方向 |

## 日次サマリー

24時間ごとに以下のサマリーが自動配信される:

```
#BTCto70k 日次サマリー

BTC/JPY: ¥10,200,000
24h High: ¥10,350,000
24h Low: $67,000

シグナル数: 3
  BUY: 2
  SELL: 1
```

## サブスクリプション

### プラン

| プラン | 価格 | 内容 |
|--------|------|------|
| Monthly | $5/月 | BTC シグナル全配信 (Discord + Telegram) |

### 登録方法

1. Discord で `!subscribe` / Telegram で `/subscribe` を送信
2. 決済リンクが送られる (Stripe Checkout)
3. カード情報を入力して決済完了
4. サブスクリプションが有効化

## セットアップ (開発者向け)

```bash
git clone https://github.com/hiroyafushimi/earn-btc-signal-bot.git
cd earn-btc-signal-bot
npm i
cp config/.env.example .env
# .env を編集してトークン・APIキーを設定
npm start
```

詳細は [README.md](../README.md) および [開発ガイド](GUIDE.md) を参照。

## #BTCto70k について

BTC が $70,000 に到達することを目指すシグナル戦略。
テクニカル分析 (SMA, RSI, 複数時間足) に基づいた BUY/SELL シグナルを Discord と Telegram の両方で配信し、目標達成をサポートする。
